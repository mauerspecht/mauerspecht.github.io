<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>深入理解GFW——路由扩散技术 | Mauerspecht</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">深入理解GFW——路由扩散技术</h1><a id="logo" href="/.">Mauerspecht</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">深入理解GFW——路由扩散技术</h1><div class="post-meta">Feb 18, 2010<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script></div><div class="post-content"><p><a href="https://gfwrev.blogspot.com/2009/11/gfw_05.html" target="_blank" rel="external">原文链接</a></p>
<blockquote>
<p>GFW的重要工作方式之一是在网络层的针对IP的封锁。事实上，GFW采用的是一种比传统的<strong>访问控制列表</strong>（Access Control List，<strong>ACL</strong>）高效得多的控制访问方式——<strong>路由扩散技术</strong>。分析这种新的技术之前先看看传统的技术，并介绍几个概念。</p>
</blockquote>
<h3 id="访问控制列表（ACL）"><a href="#访问控制列表（ACL）" class="headerlink" title="访问控制列表（ACL）"></a>访问控制列表（ACL）</h3><p>ACL可以工作在网络的二层（链路层）或是三层（网络层），以工作在三层的ACL为例，基本原理如下：想在某个路由器上用ACL控制（比如说是切断）对某个IP地址的访问，那么只要把这个IP地址通过配置加入到ACL中，并且针对这个IP地址规定一个控制动作，比如说最简单的丢弃。当有报文经过这个路由器的时候，在转发报文之前首先对ACL进行匹配，若这个报文的目的IP地址存在于ACL中，那么根据之前ACL中针对该IP地址定义的控制动作进行操作，比如丢弃掉这个报文。这样通过ACL就可以切断对于这个IP的访问。ACL同样也可以针对报文的源地址进行控制。如果ACL工作在二层的话，那么ACL控制的对象就从三层的IP地址变成二层的MAC地址。从ACL的工作原理可以看出来，ACL是在正常报文转发的流程中插入了一个匹配ACL的操作，这肯定会影响到报文转发的效率，如果需要控制的IP地址比较多，则ACL列表会更长，匹配ACL的时间也更长，那么报文的转发效率会更低，这对于一些骨干路由器来讲是不可忍受的。</p>
<h3 id="路由协议与路由重分发"><a href="#路由协议与路由重分发" class="headerlink" title="路由协议与路由重分发"></a>路由协议与路由重分发</h3><p>而GFW的网络管控方法是利用了OSPF等路由协议的<strong>路由重分发</strong>（redistribution）功能，可以说是“<strong>歪用</strong>”了这个本来是正常的功能。</p>
<h3 id="动态路由协议"><a href="#动态路由协议" class="headerlink" title="动态路由协议"></a>动态路由协议</h3><p>说路由重分发之前先简单介绍下动态路由协议。正常情况下路由器上各种路由协议如OSPF、IS-IS、BGP等，各自计算并维护自己的路由表，所有的协议生成的路由条目最终汇总到一个路由管理模块。对于某一个目的IP地址，各种路由协议都可以计算出一条路由。但是具体报文转发的时候使用哪个协议计算出来的路由，则由路由管理模块根据一定的算法和原则进行选择，最终选择出来一条路由，作为实际使用的路由条目。<br>静态路由</p>
<p>相对于由动态路由协议计算出来的动态路由条目，还有一种路由不是由路由协议计算出来的，而是由管理员手工配置下去的，这就是所谓的静态路由。这种路由条目优先级最高，存在静态路由的情况下路由管理模块会优先选择静态路由，而不是路由协议计算出来的动态路由。</p>
<h3 id="路由重分发"><a href="#路由重分发" class="headerlink" title="路由重分发"></a>路由重分发</h3><p>刚才说到正常情况下各个路由协议是只维护自己的路由。但是在某些情况下比如有两个AS（自治系统），AS内使用的都是OSPF协议，而AS之间的OSPF不能互通，那么两个AS之间的路由也就无法互通。为了让两个AS之间互通，那么要在两个AS之间运行一个域间路由协议BGP，通过配置，使得两个AS内由OSPF计算出来的路由，能通过BGP在两者之间重分发。BGP会把两个AS内部的路由互相通告给对方AS，两个AS就实现了路由互通。这种情况就是通过BGP协议重分发OSPF协议的路由条目。</p>
<p>另外一种情况，管理员在某个路由器上配置了一条静态路由，但是这条静态路由只能在这台路由器上起作用。如果也想让它在其他的路由器上起作用，最笨的办法是在每个路由器上都手动配置一条静态路由，这很麻烦。更好的方式是让OSPF或是IS-IS等动态路由协议来重分发这条静态路由，这样通过动态路由协议就把这条静态路由重分发到了其他路由器上，省去了逐个路由器手工配置的麻烦。</p>
<h3 id="GFW路由扩散技术的工作原理"><a href="#GFW路由扩散技术的工作原理" class="headerlink" title="GFW路由扩散技术的工作原理"></a>GFW路由扩散技术的工作原理</h3><p>前面说了是“歪用”，正常的情况下静态路由是由管理员根据网络拓扑或是基于其他目的而给出的一条路由，这条路由最起码要是<strong>正确</strong>的，可以引导路由器把报文转发到正确的目的地。而GFW的路由扩散技术中使用的静态路由其实是一条<strong>错误的路由，而且是有意配置错误的</strong>。其目的就是为了把本来是发往某个IP地址的报文统统引导到一个“<strong>黑洞服务器</strong>”上，而不是把它们转发到正确目的地。这个黑洞服务器上可以什么也不做，这样报文就被无声无息地丢掉了。更多地，可以在服务器上对这些报文进行分析和统计，获取更多的信息，甚至可以做一个虚假的回应。</p>
<h3 id="评价"><a href="#评价" class="headerlink" title="评价"></a>评价</h3><p>有了这种新的方法，以前配置在ACL里的每条IP地址就可以转换成一条故意配置错误的静态路由信息。这条静态路由信息会把相应的IP报文引导到黑洞服务器上，通过动态路由协议的路由重分发功能，这些错误的路由信息可以发布到整个网络。这样对于路由器来讲现在只是在根据这条路由条目做一个常规报文转发动作，无需再进行ACL匹配，与以前的老方法相比，大大提高了报文的转发效率。而路由器的这个常规转发动作，却是把报文转发到了黑洞路由器上，这样既提高了效率，又达到了控制报文之目的，手段更为高明。</p>
<p>这种技术在正常的网络运营当中是不会采用的，错误的路由信息会扰乱网络。正常的网络运营和管控体系的需求差别很大，管控体系需要屏蔽的IP地址会越来越多。正常的网络运营中的ACL条目一般是固定的，变动不大、数量少，不会对转发造成太大的影响。而这种技术直接频繁修改骨干路由表，一旦出现问题，将会造成骨干网络故障。</p>
<p>所以说GFW是歪用了路由扩散技术，正常情况下没有那个运营商会把一条错误的路由信息到处扩散，这完全是歪脑筋。或者相对于正常的网络运营来说，GFW对路由扩散技术的应用是一种小聪明的做法。正常的路由协议功能被滥用至此，而且非常之实用与高效，兲朝在这方面真是人才济济。</p>
<h3 id="测量"><a href="#测量" class="headerlink" title="测量"></a>测量</h3><p>GFW动态路由系统概括起来就是：人工配置(c)样本路由器(sr)的静态路由(r)，向各ISP的出入口路由器(or)扩散此路由(r)，将特定网络流量转到黑洞服务器(fs)进行记录。因此可以进行测量的项目有：</p>
<ul>
<li>(r)被封锁的IP列表：可以通过协作报告机制收集用户报告，也可通过扫描著名站点获得；（传言：GFW动态路由系统的容量是几十万条规则）</li>
<li>(or)受到GFW影响的ISP出入口路由器：通过在广域多ISP内的节点协作traceroute可以测得；</li>
<li>(or)-(c)从关键词生效到动态路由生效的延迟：通过建立蜜罐并提交给GFW然后观察其响应；</li>
<li>(fs)黑洞服务器的健壮性：用伪源噪音流量对黑洞服务器进行填充，观测其响应。</li>
</ul>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol>
<li><p>刘刚, 云晓春, 方滨兴, 胡铭曾. “一种基于路由扩散的大规模网络控管方法”. 通信学报, 24(10): 159-164. 2003.</p>
</li>
<li><p>李蕾, 乔佩利, 陈训逊. “一种IP访问控制技术的实现”. 信息技术, (6). 2001.</p>
</li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://Mauerspecht.org/2010/02/18/understanding_gfw_2/" data-id="cj7czud8i00015g0k2aws26ym" class="article-share-link">Share</a><div class="tags"><a href="/tags/GFW/">GFW</a></div><div class="post-nav"><a href="/2010/05/21/understanding_gfw_4/" class="pre">深入理解GFW——结论</a><a href="/2010/01/23/understanding_gfw_1/" class="next">深入理解GFW——DNS污染</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://Mauerspecht.org"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/长城防火墙/" style="font-size: 15px;">长城防火墙</a> <a href="/tags/mauerspecht/" style="font-size: 15px;">mauerspecht</a> <a href="/tags/一字之差/" style="font-size: 15px;">一字之差</a> <a href="/tags/DNS篡改/" style="font-size: 15px;">DNS篡改</a> <a href="/tags/联合国/" style="font-size: 15px;">联合国</a> <a href="/tags/人权理事会/" style="font-size: 15px;">人权理事会</a> <a href="/tags/中国季刊/" style="font-size: 15px;">中国季刊</a> <a href="/tags/ChinaQuarterly/" style="font-size: 15px;">ChinaQuarterly</a> <a href="/tags/berlin-wall/" style="font-size: 15px;">berlin wall</a> <a href="/tags/GFW/" style="font-size: 15px;">GFW</a> <a href="/tags/俄罗斯/" style="font-size: 15px;">俄罗斯</a> <a href="/tags/土耳其/" style="font-size: 15px;">土耳其</a> <a href="/tags/反华/" style="font-size: 15px;">反华</a> <a href="/tags/Reagan/" style="font-size: 15px;">Reagan</a> <a href="/tags/VPN/" style="font-size: 15px;">VPN</a> <a href="/tags/censorship/" style="font-size: 15px;">censorship</a> <a href="/tags/Apple/" style="font-size: 15px;">Apple</a> <a href="/tags/UML/" style="font-size: 15px;">UML</a> <a href="/tags/graphvia/" style="font-size: 15px;">graphvia</a> <a href="/tags/plant-UML/" style="font-size: 15px;">plant UML</a> <a href="/tags/博讯/" style="font-size: 15px;">博讯</a> <a href="/tags/公开信/" style="font-size: 15px;">公开信</a> <a href="/tags/审查/" style="font-size: 15px;">审查</a> <a href="/tags/United-Nations/" style="font-size: 15px;">United Nations</a> <a href="/tags/Human-Rights-Council/" style="font-size: 15px;">Human Rights Council</a> <a href="/tags/wiki/" style="font-size: 15px;">wiki</a> <a href="/tags/HTTP-URL/" style="font-size: 15px;">HTTP URL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/06/un-china-blocks-activists-harasses-experts_cn/">联合国：中国阻挠维权人士、骚扰专家</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/06/un-china-blocks-activists-harasses-experts/">China Blocks Activists, Harasses Experts</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/test_dns_pollution/">测量全球的 DNS 纂改</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/China_Quarterly_2/">面对学术界反弹 《中国季刊》300篇被删文章恢复发表</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/19/How_does_gfw_work/">中國的網路寒冬：防火長城究竟如何運作？</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/19/China_Quarterly_1/">《中国季刊》:对中国删300多篇文章深表关注</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/13/about-Tex/">about-Tex</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/06/Turkey_media_anti-china_2/">土耳其外长：我国境内不得反华</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/04/Turkey_media_anti-china/">誓言空洞? 土耳其承诺将在国内媒体中消除反华报道</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/03/apple_remove_vpn/">Apple removes VPN apps in China as Beijing doubles down on censorship</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="https://zh.greatfire.org/" title="Great Fire" target="_blank">Great Fire</a><ul></ul><a href="https://program-think.blogspot.com" title="编程随想" target="_blank">编程随想</a><ul></ul><a href="https://pao-pao.net" title="泡泡" target="_blank">泡泡</a><ul></ul><a href="https://xiaolan.me/" title="Xiaolan's Blog" target="_blank">Xiaolan's Blog</a><ul></ul><a href="http://www.chinagfw.org" title="GFW Blog" target="_blank">GFW Blog</a><ul></ul><a href="https://2xiangzi.blogspot.com/" title="二翔子的博客" target="_blank">二翔子的博客</a><ul></ul><a href="https://gfw.press/" title="GFW.Press" target="_blank">GFW.Press</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Mauerspecht.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>
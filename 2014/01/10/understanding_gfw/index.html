<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>深入理解GFW——总论 | Mauerspecht</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">深入理解GFW——总论</h1><a id="logo" href="/.">Mauerspecht</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">深入理解GFW——总论</h1><div class="post-meta">Jan 10, 2014<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script></div><div class="post-content"><p><a href="https://gfwrev.blogspot.com/2009/10/gfw.html" target="_blank" rel="external">原文链接</a></p>
<blockquote>
<p>GFW，Great Firewall of China，防火长城，通常把它看作一个国家级的网络审查系统。关于网络审查，人们通常首先会有一番政治性的话要说，不过政治批评这个角度的言论实在是过多，GFW的实体在“GFW”这个这个巨大的外壳之下隐藏了多年，人们只是对着“GFW”这个词空发怒气却并不知道它究竟是什么。实际上GFW除了是一个让网民十分不舒服的系统之外，在技术上它还是一个非常复杂有趣的黑箱，一个通关奖品是网络自由的解谜游戏。接下来一段时间我们便会对GFW进行深入的探索和理解，大家很快就会了解到它的趣味。提示：阅读此“深入理解GFW”系列之前建议读者对TCP/IP协议族、网络安全、反向工程有基本的了解。</p>
</blockquote>
<h3 id="GFW的技术结构"><a href="#GFW的技术结构" class="headerlink" title="GFW的技术结构"></a>GFW的技术结构</h3><p>知己知彼，百战不殆，我们应该先对GFW有清晰的技术性认识。防火长城条目称GFW的主要技术是域名劫持、IP封锁、关键字过滤阻断、HTTPS证书过滤。实际上这些技术在实现上可以归结为两种技术：IP封锁和入侵检测，其中入侵检测是核心。IP封锁因为比较底层，接近于切光缆拔网线，没有什么技术可言，这种封锁实施以后除了绕道而过也没有更好的解决办法。而入侵检测则是GFW最为强大灵活的功能。</p>
<p>传输层的TCP和UDP解析都是入侵检测业界的标准配置。UDP通常用来做DNS查询劫持，一个附加效果就是国内的域名缓存充满了麤。TCP主要用作阻断，方式很多了，总之只要把攻击者的连接关闭掉/阻止攻击者进行连接就行了。应用层就更加百花齐放了，因为解析一个协议实在不是一件困难的事情。所谓的SSL证书拦截也不过是稍微做了一下SSL/TLS协议的解析而已，并无神秘之处。这就是入侵检测的强大之处。</p>
<p>入侵检测的灵活之处在于它的部署和撤销都很便捷无副作用无延迟，匹配精确无误伤。举一例，要防止一些反动软件通过https访问google docs获取信息，怎么做？在应用层检测证书显然是杀鸡用牛刀浪费性能了；用动态路由封特定IP的特定端口是不行的，因为解析结果在不断地变，动态路由的变化跟不上；用域名污染更不行了，把80端口的web业务也搞掉了，影响太大；所以就在传输层乱发RST做无状态的连接阻断，写个脚本定时更新解析结果，这也就是google的数据中心只有在中国解析出来的那部分被封掉的原因。什么时候领导对谷歌的红包满意了，随时撤掉。</p>
<p>GFW的设备有两种，一种是在北京、上海、广州搭在总交换中心上做旁路监听的入侵检测设备，一种是放在ISP那里的动态路由设备。一般来说入侵检测总是比动态路由来得灵活，所以RST要比封IP更常用。另外，碰到网站无法访问然后traceroute发现线路死在ISP骨干上于是责怪ISP，这是不合理的。中国的ISP的一项主要业务就是接待各个强力部门的插入，纪检、军队、公安之类的部门都会长期插入。</p>
<h3 id="GFW的工作方式"><a href="#GFW的工作方式" class="headerlink" title="GFW的工作方式"></a>GFW的工作方式</h3><p>GFW的日常工作方式：当国新办发现了反动文宣，当公安部十一局发现了色情图片，当版署发现了海盗网站，总之当有关部门发现了有害非法信息，就发指令给GFW，然后GFW的政策部门研究一下采取怎样的具体封锁措施为宜，然后将具体操作交给技术部门执行封锁。解封也是一样的渠道，简而言之就是领导一句话胜过千军万马，至于让领导发这一句话靠的就是PR了。举一例，受到NED暗中操控的twitter长期以来充满反动有害信息，但做技术的人都明白twitter的这种架构是没有办法封的。对twitter.com什么办法都用了，效果不大好，结果领导不满意地催促了。这个交不了差是很严重的事情啊，怎么办呢，就对twitter搞破坏吧。凡是跟twitter有关的第三方网站，见一个斩一个，领导你看我都把twitter诛九族了，这已经是自古以来用刑的极致了。再举一例，如何封掉一个网站？先在这个网站上放置一些有害非法信息，再去违法和不良信息举报中心（后台国新办）举报之，等十天就成了。</p>
<p>GFW的研发方式：“国家信息安全管理系统”建设的历史参见《阅后即焚》。当有关部门发现了一个反革命翻墙方法，就告诉GFW，然后GFW的逆向工程人才研究一下这个方法的工作方式，找到它的特定模式和弱点，制定相应的封锁预案。当有关部门指示实施封锁的时候，预案便付诸实施。p2p方面的反动软件比较不好办，于是在第一生产力院成立242项目“P2P协议分析与测量”专门研究之。</p>
<p>GFW实体是安管中心（CNCERT/CC），是事业单位。一个事业单位的政治地位可以想是很低的，凡是它的上级都可以向它下指令进行网络封锁，而它本身则没有任何主观能动性，专于业务，勤勤恳恳抓好国家安全基础设施的建设。如果转换角度，从GFW的视角来考虑，那么GFW所做的事情其实并不神秘，其实恰恰符合了它自己的名义。我们来看看精美的“<a href="http://www.cert.org.cn/articles/researchProject/common/2006112023094.shtml" target="_blank" rel="external">宽带网络环境下恶意代码监测系统</a>”，你们这些反革命访问一下blogger、wordpress那就是URL攻击啊，而且要比一般的钓鱼攻击和病毒更严重，因为危害的是党和国家的安全啊。GFW的研发也与一般的网络安全公司所做别无二致，监视分析网络流量，逆向工程有害软件，阻断恶意攻击，区别只在于：GFW为了国家安全也要处理一下你们这些反革命的攻击；另外GFW还开了金钱无限、人口无限和无敌秘笈。</p>
<h3 id="GFW与网民的生态系统"><a href="#GFW与网民的生态系统" class="headerlink" title="GFW与网民的生态系统"></a>GFW与网民的生态系统</h3><p>政府、GFW与网民构成了一个生态系统，政府与GFW共生于食物链的上端，网民处于食物链的下端。有人称之为“猫和老鼠的游戏”。观GFW与网民的互动历史，可以归结为相互提升技术水准的军备竞赛，但尽管如此两者的关系也从来没有打破GFW越来越善于主动追捕网民越来越善于被动逃避的模式。从最开始的普通HTTP代理、SOCKS代理，到以自由门为代表的一批加密代理软件，到种类繁多的网页代理，到VPN、SSH代理，到p2p网络，以及混合方法。然而这些方法都未曾彻底免于GFW的封锁，这是因为GFW很善于进攻，而网民们迄今为止只会不断地四处寻找新的逃避办法。</p>
<p>这种互动模式的问题在于，随着军备竞赛的继续，GFW越来越完善越来越强大，而网民不断地失去手中的牌，翻墙的难度和成本越来越高。GFW是这个领域（网络安全）的专业人士，而网民虽然富有群体智慧，但是其技术能力缺乏有效组织不能与GFW对等。因此如果稍微看得远一些就会了解到，这种模式对于网民来说是不可持续的，总有一天GFW会超过绝大多数网民的技术基准线。所以，唯一的出路便是改变方式，突破这种模式。</p>
<h3 id="应对GFW"><a href="#应对GFW" class="headerlink" title="应对GFW"></a>应对GFW</h3><p>网民突破当前被动态势方法的基本原理，在后面的章节中我们会看到，在于利用GFW在善于进攻的同时不善于防守的特点。与其把GFW看作国家网络暴力机关，不如把GFW看作一个网络安全机构，事实上它也是一个网络安全机构（CNCERT/CC）。任何安全系统必然都有漏洞和弱点，它所提供的这个GFW安全解决方案（国家信息安全管理系统）也不例外。网民并非缺乏技术，而是技术没有得到有效组织，没有往这个方向进行有效投射。实际上GFW漏洞和弱点并不少，有一些甚至是理论上无法解决的，这在以后会详细论述。正如《阅后即焚》一文所言，GFW尽管是中国少有的顶尖科研力量与国家强力支持结合的产物，“但也无法摆脱山寨的本性——做一个东西出来很容易，但是要把这个东西做得细致严格就不行了”。</p>
<p>更进一步，除了利用GFW本身的问题以外，网民甚至还可以考虑采取网络正当防卫的方式阻止GFW的非法行为。像GFW这种机构，无行政立法，无舆论监督，无申诉渠道，被少数别有用心的人利用，滥用国家安全之名义，封锁与国家安全毫无关系的网站，对合法的网络通信进行干扰和攻击，“对计算机信息系统正在进行传输的合法数据进行篡改，向计算机信息系统进行攻击令其无法正常运行”，甚至曾多次造成全国性网络故障，已触犯《中华人民共和国刑法》第二百八十六条，情节特别严重，后果特别恶劣，云云。</p>
<p>然而另一方面，GFW与网民之间已经或者即将形成某种稳态，这种稳态是双方斗争状况下的动态平衡，是需要有意识维护的。一个无法控制的网络是无法被政府所容忍的，当网络无法控制时政府是不吝于切断一切网络的（你一定知道我在说什么），稳态的破坏也就意味着环境的毁灭。一个理想的稳态就是网络处于“看起来”可以控制的状态，让GFW处于不断取得小型封锁成功的虚幻胜利感之中，网民个人各自掌握非中心化的翻墙方法。一个中心化的大众翻墙方法（最典型的例子就是设置hosts静态解析）必定无法避免被当局发现并被GFW封锁。下一代的翻墙方法应该是去中心化的（p2p）、小众的、多样化的、混合型的、动态更新的。</p>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p>有两篇重要文献在这里要推荐。</p>
<p>首先是Thomas Ptacek等在98年发表的Insertion, Evasion, and Denial of Service: Eluding Network Intrusion Detection。这篇是在入侵检测领域具有里程碑意义的论文，是论述入侵检测原理性漏洞的集大成者。其简明介绍早在07年就出现在英文维基，非专业人士可以<a href="http://en.wikipedia.org/wiki%20/Intrusion_detection_system_evasion_techniques" target="_blank" rel="external">一睹为快</a>；专业人士建议仔细阅读原文，以后关于探索GFW漏洞的技术都基于此篇论文所描述的原理。</p>
<p>另外一篇是《阅后即焚：“GFW”》，是一份关于GFW的详尽的社会调查，澄清了大量关于GFW的误解，本文大量引用此文。这篇文章的重要性从侧面可以发现：前面引用过中文维基的防火长城条目，如果直接访问会发现，这个条目直接访问之后维基百科就被封锁了。这是有原因的，而且原因是可以找到的，寻找原因的方法将在以后几节介绍，这里长话短说原因就是：这个页面中含有一个关键词：“阅后即焚”。与一般的关键词不同，这个关键词很厉害，随便什么地方出现这个关键词都会引起有趣的现象，比如<a href="http://pastebin.ca/1640021" target="_blank" rel="external">这里</a>，这种现象通常被人们称为深度包检测。像法轮六四这样煽动颠覆的词语都没有成为深度检测关键词，这种顶级过滤的词很少，另一个例子就是GFW头号死敌的名字：“dongtaiwang.com”。一般来说，越是被禁止，就越有趣；越是被否认，就越接近真相。另外注意到，有一篇内容相似的文章《GFW的前世今生》，对比两者发现后者似乎被添加了一些不相关或者夸张性的文字，原文应该是首发在自曲新闻的前者。</p>
<p>在下一次的文章中我们将介绍GFW进行黑箱分析的方法，并得到一些有趣的结果。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://Mauerspecht.org/2014/01/10/understanding_gfw/" data-id="cj7xekg5s001p6w0k9awujdmj" class="article-share-link">Share</a><div class="tags"><a href="/tags/GFW/">GFW</a></div><div class="post-nav"><a href="/2014/01/15/360gfw/" class="pre">奇虎360成功加入GFW防火长城 为国家安全保驾护航</a><a href="/2013/11/21/Document-about-GFW/" class="next">Documents about GFW</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://Mauerspecht.org"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Reagan/" style="font-size: 15px;">Reagan</a> <a href="/tags/GFW/" style="font-size: 15px;">GFW</a> <a href="/tags/长城防火墙/" style="font-size: 15px;">长城防火墙</a> <a href="/tags/中国季刊/" style="font-size: 15px;">中国季刊</a> <a href="/tags/ChinaQuarterly/" style="font-size: 15px;">ChinaQuarterly</a> <a href="/tags/mauerspecht/" style="font-size: 15px;">mauerspecht</a> <a href="/tags/俄罗斯/" style="font-size: 15px;">俄罗斯</a> <a href="/tags/berlin-wall/" style="font-size: 15px;">berlin wall</a> <a href="/tags/wiki/" style="font-size: 15px;">wiki</a> <a href="/tags/土耳其/" style="font-size: 15px;">土耳其</a> <a href="/tags/反华/" style="font-size: 15px;">反华</a> <a href="/tags/一字之差/" style="font-size: 15px;">一字之差</a> <a href="/tags/VPN/" style="font-size: 15px;">VPN</a> <a href="/tags/censorship/" style="font-size: 15px;">censorship</a> <a href="/tags/Apple/" style="font-size: 15px;">Apple</a> <a href="/tags/360/" style="font-size: 15px;">360</a> <a href="/tags/HTTP-URL/" style="font-size: 15px;">HTTP URL</a> <a href="/tags/群主负责/" style="font-size: 15px;">群主负责</a> <a href="/tags/UML/" style="font-size: 15px;">UML</a> <a href="/tags/graphvia/" style="font-size: 15px;">graphvia</a> <a href="/tags/plant-UML/" style="font-size: 15px;">plant UML</a> <a href="/tags/方滨兴/" style="font-size: 15px;">方滨兴</a> <a href="/tags/DNS篡改/" style="font-size: 15px;">DNS篡改</a> <a href="/tags/United-Nations/" style="font-size: 15px;">United Nations</a> <a href="/tags/Human-Rights-Council/" style="font-size: 15px;">Human Rights Council</a> <a href="/tags/联合国/" style="font-size: 15px;">联合国</a> <a href="/tags/人权理事会/" style="font-size: 15px;">人权理事会</a> <a href="/tags/博讯/" style="font-size: 15px;">博讯</a> <a href="/tags/公开信/" style="font-size: 15px;">公开信</a> <a href="/tags/审查/" style="font-size: 15px;">审查</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/12/owner_responsible/">公安紧急提醒：多名群主已被拘留处分！9种消息千万别发！</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/internet_rules/">互联网群组信息服务管理规定</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/06/un-china-blocks-activists-harasses-experts_cn/">联合国：中国阻挠维权人士、骚扰专家</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/06/un-china-blocks-activists-harasses-experts/">China Blocks Activists, Harasses Experts</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/test_dns_pollution/">测量全球的 DNS 纂改</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/China_Quarterly_2/">面对学术界反弹 《中国季刊》300篇被删文章恢复发表</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/19/How_does_gfw_work/">中國的網路寒冬：防火長城究竟如何運作？</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/19/China_Quarterly_1/">《中国季刊》:对中国删300多篇文章深表关注</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/13/about-Tex/">about-Tex</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/06/Turkey_media_anti-china_2/">土耳其外长：我国境内不得反华</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="https://zh.greatfire.org/" title="Great Fire" target="_blank">Great Fire</a><ul></ul><a href="https://program-think.blogspot.com" title="编程随想" target="_blank">编程随想</a><ul></ul><a href="https://pao-pao.net" title="泡泡" target="_blank">泡泡</a><ul></ul><a href="https://xiaolan.me/" title="Xiaolan's Blog" target="_blank">Xiaolan's Blog</a><ul></ul><a href="http://www.chinagfw.org" title="GFW Blog" target="_blank">GFW Blog</a><ul></ul><a href="https://2xiangzi.blogspot.com/" title="二翔子的博客" target="_blank">二翔子的博客</a><ul></ul><a href="https://gfw.press/" title="GFW.Press" target="_blank">GFW.Press</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Mauerspecht.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>